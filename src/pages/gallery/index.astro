---
import { fetchLatestGallery, fetchGalleryList } from '../../utils/sanity';
import BaseLayout from '../../layouts/BaseLayout.astro';

import type { Gallery, GalleryData } from '../../types/gallery';

const latestGallery: GalleryData | null = await fetchLatestGallery();
const galleries: Gallery[] = await fetchGalleryList();

---

<BaseLayout>
  <h1>Photo Galleries</h1>

  <!-- Section 1: Most Recent Gallery -->
  <section>
    {latestGallery ? (
      <>
        <h2>Latest Gallery: {latestGallery.title}</h2>
        {latestGallery.date && <p>{latestGallery.date}</p>}

        <div>
          {latestGallery.images && latestGallery.images.length > 0 ? (
            latestGallery.images.map((img) => (
              <img src={img.url} alt="Gallery Image" />
            ))
          ) : (
            <p>No images available.</p>
          )}
        </div>
      </>
    ) : (
      <p>No galleries found.</p>
    )}
  </section>

  <!-- Section 2: Other Galleries Navigation -->
  <section>
    <h2>Other Galleries</h2>
    <nav>
      <ul>
        {galleries.map((g) => (
          <li>
            <a href={`/gallery/${g.slug}`}>{g.title}</a>
            {g.date && <span> ({g.date})</span>}
          </li>
        ))}
      </ul>
    </nav>
  </section>
</BaseLayout>
