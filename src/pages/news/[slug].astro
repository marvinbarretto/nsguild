---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { fetchAllPosts, fetchPostBySlug } from "../../sanity/queries/news";

import PortableText from "../../components/shared/PortableText.astro";

// ✅ Step 1: Define `getStaticPaths()`
export async function getStaticPaths() {
  const posts = await fetchAllPosts();  // Fetch all news posts
  console.log("Generating static paths for news:", posts.map(p => p.slug)); // Debugging

  return posts.map((post) => ({
    params: { slug: post.slug }, // ✅ Ensures `slug` is a string
    props: { post },  // ✅ Pre-fetch the post data
  }));
}

const { slug } = Astro.params;  // ✅ Get the slug from the route

if (!slug) {
  throw new Error("Missing parameter: slug");  // ✅ Debugging check
}

const post = await fetchPostBySlug(slug);

if (!post) {
  throw new Error(`No post found for slug: ${slug}`);  // ✅ Debugging check
}
---

<BaseLayout>
  <article>
    <h1>{post.title}</h1>
    <p><strong>Published:</strong> {post.publishedAt}</p>
    <div class="post-content">
      <PortableText portableText={post.body} />
    </div>
  </article>
</BaseLayout>

